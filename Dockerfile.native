# Build native image using GraalVM via Maven profile
FROM ghcr.io/graalvm/native-image:21 as native-build
WORKDIR /workspace
COPY pom.xml .
COPY src ./src
RUN mvn -q -Pnative -DskipTests package

FROM gcr.io/distroless/base-debian12
ENV SERVER_PORT=8080
WORKDIR /app
COPY --from=native-build /workspace/target/distributed-inventory /app/app
EXPOSE 8080
USER 65532:65532
ENTRYPOINT ["/app/app", "--server.port=8080"]

